# Plan for Handling Empty pre_patch.patch File

## Notes
- If pre_patch.patch is empty, the logic should not be blocked; simply skip applying it.
- Investigate bug where held_out_tests.patch is being applied twice, causing errors about files already existing in the working directory.
- Root cause: patch is applied to a dirty git state in containers; need to add git reset/clean before applying held_out_tests.patch.
- This has been tested and the double application issue is resolved.
- When running 'rubric_set' with --force, all child 'rubric_shell' steps (upserted and new) should have {"rerun":true} set, and after each run the flag should be set to false regardless of command output.
- 'Rerun' field has been added to RubricShellConfig struct to support rerun logic.
- RubricShellConfig.Rerun is now reset to false after rubric_shell execution.
- Git cleaning operations (reset/clean) now occur before any patch application, not after pre_patch.patch is applied.
- Git cleaning logic in ProcessRubricShellStep has been deduplicated.

## Task List
- [x] Update logic to skip git apply if pre_patch.patch is empty
- [x] Investigate and fix double application of held_out_tests.patch
  - [x] Add git reset/clean before applying held_out_tests.patch (ensure cleaning is before any patch application)
- [x] Update rubric_set logic: set {"rerun":true} on all child rubric_shell steps (upserted and new) when --force is used, and reset to false after each run
  - [x] Reset rerun flag to false after rubric_shell execution
  - [x] Deduplicate redundant git cleaning commands in ProcessRubricShellStep

## Current Goal
Project complete â€“ monitor for regressions and future changes
